<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Five-Section Survey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg: #0f1412;
      --card: rgba(255,255,255,0.08);
      --card-strong: rgba(255,255,255,0.12);
      --ink: #f5f6f5;
      --muted: #cfd6cf;
      --accent: #a59172;   /* user’s palette */
      --accent-2: #273e33; /* user’s palette */
      --accent-3: #d8ceaf; /* user’s palette */
      --danger: #ff6b6b;
      --ok: #4cd964;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,0.25);
      --radio-size: 14px;  /* smaller radios */
      --option-font-size: 13px
      
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%; margin: 0; color: var(--ink);
      background:
        radial-gradient(1200px 800px at 20% -10%, #1f2c27 0%, transparent 60%),
        radial-gradient(1200px 800px at 120% 0%, #1f2c27 0%, transparent 50%),
        linear-gradient(180deg, #15201b 0%, var(--bg) 100%);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }

    header.appbar{
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(21,32,27,0.9), rgba(21,32,27,0.6));
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .wrap{ max-width: 1100px; margin: 0 auto; padding: 16px 20px; }
    .brand{ display: flex; align-items: center; gap: 12px; }
    .logo{
      width: 32px; height: 32px; border-radius: 10px;
      background: conic-gradient(from 180deg, var(--accent-3), var(--accent), var(--accent-2), var(--accent-3));
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.15);
    }
    .title{ font-weight: 700; letter-spacing: 0.2px; }

    nav.sections{ display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    nav.sections a{
      text-decoration: none; color: var(--ink);
      background: var(--card); padding: 8px 12px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      transition: transform .15s ease, background .2s ease;
    }
    nav.sections a:hover{ transform: translateY(-1px); background: var(--card-strong); }

    .progress{
      margin-top: 14px; background: rgba(255,255,255,0.08);
      height: 10px; border-radius: 999px; overflow: hidden;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .bar{
      height: 100%; width: 0%;
      background: linear-gradient(90deg, var(--accent-2), var(--accent), var(--accent-3));
      transition: width .25s ease;
    }
    .meter{ margin-top: 6px; font-size: 17px; color: var(--muted); }

    main{ padding: 24px 20px 100px; }
    .grid{
      max-width: 1100px; margin: 0 auto; display: grid; gap: 20px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 900px){ .grid{ grid-template-columns: 1fr 1fr; } }

    /* Plain options: remove big circle/pill backgrounds */
    .choices .choice{
      background: transparent !important;
      border: 0 !important;
      border-radius: 0 !important;
      padding: 0 !important;
      box-shadow: none !important;
      transform: none !important;
      flex-direction: column;       /* radio on top, text below */
      align-items: center;
      text-align: center;
      gap: 6px;
    }
    .choices .choice:hover{ background: transparent !important; }
    .choices{ gap: 10px 18px; }

    /* Text label without pill */
    .choices .choice .tag{
      background: transparent !important;
      border: 0 !important;
      border-radius: 0 !important;
      padding: 0 !important;
      color: var(--ink);
      font-weight: 500;
      display: block; line-height: 1.1;
      font-size: var(--option-font-size);
    }

    /* Radio size + color (no scaling) */
    .choices .choice input[type="radio"]{
      margin: 0;
      width: var(--radio-size); height: var(--radio-size);
      min-width: var(--radio-size); min-height: var(--radio-size);
      accent-color: var(--accent);
    }
    /* Subtle focus underline on text when keyboard focusing the radio */
    .choices .choice input[type="radio"]:focus-visible + .tag{
      outline: none;
      box-shadow: inset 0 -2px 0 0 rgba(165,145,114,.8);
    }

    section.card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: clip;
    }
    .card .body fieldset{
        display: grid;
        gap: 10px;
        }
    .card header{
      padding: 16px 18px;
      background: linear-gradient(180deg, rgba(168,145,114,0.12), rgba(168,145,114,0.02));
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .card h2{ margin: 0; font-size: 18px; letter-spacing: 0.3px; }
    .card .body{ padding: 16px 18px 18px; display: grid; gap: 14px; }

    fieldset{
      border: 1px dashed rgba(255,255,255,0.18);
      border-radius: 14px; padding: 14px;
      display: grid; gap: 2px;    /* exactly 2px between questions */
    }
    legend{ padding: 0 8px; color: var(--muted); font-size: 15px; }

    .question{
      display: grid; gap: 10px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px; padding: 12px;
    }
    .q-title{ font-weight: 600; }
    .choices{
      display: grid; gap: 8px;
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    @media (min-width: 640px){
      .choices{ grid-template-columns: repeat(4, minmax(0,1fr)); }
    }

    .error{ border-color: rgba(255,0,0,0.45) !important; box-shadow: 0 0 0 3px rgba(255,0,0,0.15) inset; }
    .error-msg{ color: var(--danger); font-size: 13px; display: none; }
    .question.invalid .error-msg{ display: block; }

    /* Comment question look & feel */
    .question.comment{ gap: 8px; }
    .question.comment textarea{
      width: 100%; min-height: 90px; resize: vertical;
      color: var(--ink);
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 10px;
      padding: 10px 12px; font: inherit;
    }
    .question.comment textarea:focus{
      outline: none; border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(165,145,114,.30);
    }
    .comment .char-counter{ font-size: 12px; color: var(--muted); justify-self: end; }

    .actions{
      position: sticky; bottom: 0; z-index: 40;
      background: linear-gradient(180deg, rgba(21,32,27,0), rgba(21,32,27,0.95) 35%);
      padding: 22px 20px 30px; border-top: 1px solid rgba(255,255,255,0.08);
    }
    .actions .wrap-inner{
      max-width: 1100px; margin: 0 auto; display: flex; gap: 12px; flex-wrap: wrap;
    }
    button.btn{
      appearance: none; border: none; cursor: pointer;
      padding: 12px 18px; border-radius: 12px; font-weight: 700;
      color: #121412; background: var(--accent-3);
      box-shadow: var(--shadow); transition: transform .12s ease, filter .2s ease;
    }
    button.btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    button.ghost{ background: transparent; color: var(--ink); border: 1px solid rgba(255,255,255,0.2); }

    .toast{
      position: fixed; right: 16px; bottom: 16px; z-index: 60;
      background: rgba(0,0,0,0.78); padding: 12px 14px; border-radius: 12px; font-size: 14px;
      border: 1px solid rgba(255,255,255,0.12); display: none;
    }
    .toast.show{ display: block; animation: pop .18s ease; }
    @keyframes pop{ from{ transform: scale(.98); opacity: 0; } to{ transform: scale(1); opacity: 1; } }

    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden;
      clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
</head>
<body>

  <header class="appbar">
    <div class="wrap">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">Security Keys • Five-Section Survey</div>
      </div>

      <nav class="sections" id="sectionNav" aria-label="Section navigation"></nav>

      <div class="progress" aria-hidden="true">
        <div class="bar" id="progressBar"></div>
      </div>
      <div class="meter" id="progressText">Answered 0 of 25</div>
    </div>
  </header>

  <main>
    <form id="surveyForm" class="grid" autocomplete="off" novalidate></form>
  </main>

  <div class="actions">
    <div class="wrap-inner">
      <button type="button" class="btn ghost" id="btnReset">Reset</button>
      <button type="submit" class="btn" id="btnSubmit" form="surveyForm">Submit</button>
      <span id="a11yStatus" class="sr-only" aria-live="polite"></span>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
  (() => {
    'use strict';

    // ----- Survey data (edit text here) -----
    const sections = [
      {
        id: 'sec1',
        title: 'Access Control',
        questions: [
          'Our team follows a consistent process for requesting keys.',
          'Key collection points are clearly identified and accessible.',
          'Temporary access is logged accurately.',
          'Visitors are never given permanent keys.',
          'Lost keys are reported immediately.'
        ]
      },
      {
        id: 'sec2',
        title: 'Policies & Procedures',
        questions: [
          'Key handover rules are clearly communicated.',
          'Return deadlines are reasonable and understood.',
          'Exceptions require approval from a supervisor.',
          'Audits are performed at regular intervals.',
          'Policy changes are shared promptly.'
        ]
      },
      {
        id: 'sec3',
        title: 'Equipment & Tools',
        questions: [
          'Key tags and labels are readable.',
          'Storage cabinets are secure and organized.',
          'Scanning devices (barcode/RFID) work reliably.',
          'Spare keys are tracked correctly.',
          'Damaged keys are removed from circulation.'
        ]
      },
      {
        id: 'sec4',
        title: 'Incident Response',
        questions: [
          'There is a clear escalation path for late keys.',
          'We can identify who holds a key at any time.',
          'Overdue reminders are sent automatically.',
          'Incidents are reviewed after resolution.',
          'Lessons learned are documented.'
        ]
      },
      {
        id: 'sec5',
        title: 'Training & Awareness',
        questions: [
          'New staff receive key-handling training.',
          'Refresher sessions happen as needed.',
          'Guides are easy to find and follow.',
          'Roles and responsibilities are understood.',
          'Feedback is collected and acted upon.'
        ]
      }
    ];

    const choices = [
      { label: 'Strongly Disagree', value: '1' },
      { label: 'Disagree',          value: '2' },
      { label: 'Agree',             value: '3' },
      { label: 'Strongly Agree',    value: '4' }
    ];

    // ----- DOM refs -----
    const form = document.getElementById('surveyForm');
    const nav  = document.getElementById('sectionNav');
    const progressBar  = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const toast = document.getElementById('toast');
    const a11yStatus = document.getElementById('a11yStatus');
    const btnReset = document.getElementById('btnReset');

    // ----- Build UI safely (no innerHTML for dynamic text) -----
    function el(tag, cls, text){
      const e = document.createElement(tag);
      if (cls) e.className = cls;
      if (typeof text === 'string') e.textContent = text;
      return e;
    }

    function buildSurvey(){
      // Build nav
      sections.forEach((s, i) => {
        const a = document.createElement('a');
        a.href = `#${s.id}`;
        a.textContent = `${i+1}. ${s.title}`;
        a.addEventListener('click', (ev) => {
          ev.preventDefault();
          const target = document.getElementById(s.id);
          if (target) target.scrollIntoView({behavior: 'smooth', block: 'start'});
        });
        nav.appendChild(a);
      });

      // Build sections/cards
      sections.forEach((s, si) => {
        const card = el('section', 'card');
        card.id = s.id;

        const head = el('header', null);
        const h2 = el('h2', null, `${si+1}. ${s.title}`);
        head.appendChild(h2);

        const body = el('div', 'body');

        // One fieldset per section groups its questions
        const fs = document.createElement('fieldset');
        const lg = document.createElement('legend');
        lg.textContent = 'Please choose one option per question';
        fs.appendChild(lg);

        // 5 radio questions
        s.questions.forEach((q, qi) => {
          const qid = `q-${si+1}-${qi+1}`;

          const qWrap = el('div', 'question');
          qWrap.setAttribute('role', 'group');
          qWrap.setAttribute('aria-labelledby', `${qid}-label`);

          const qTitle = el('div', 'q-title');
          qTitle.id = `${qid}-label`;
          qTitle.textContent = `${si+1}.${qi+1} — ${q}`;

          const choicesWrap = el('div', 'choices');

          choices.forEach((c, ci) => {
            const label = el('label', 'choice');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = qid;
            input.value = c.value;
            // Add required to first radio only -> makes the whole group required
            if (ci === 0) input.required = true;

            const tag = el('span', 'tag', c.label);
            label.appendChild(input);
            label.appendChild(tag);
            choicesWrap.appendChild(label);
          });

          const msg = el('div', 'error-msg', 'Please select one option.');
          qWrap.appendChild(qTitle);
          qWrap.appendChild(choicesWrap);
          qWrap.appendChild(msg);
          fs.appendChild(qWrap);
        });

        // 6th item — optional comment box (not counted in progress)
        const commentWrap = el('div', 'question comment');
        const cTitle = el('div', 'q-title', `${si+1}.6 — Additional comments (optional)`);
        const textarea = document.createElement('textarea');
        textarea.name = `q-${si+1}-6-comment`;
        textarea.maxLength = 500;
        textarea.placeholder = "Type your note (max 500 characters)";
        textarea.setAttribute('aria-label', `Comments for ${s.title}`);
        const counter = el('div', 'char-counter', `0 / ${textarea.maxLength}`);
        textarea.addEventListener('input', () => {
          counter.textContent = `${textarea.value.length} / ${textarea.maxLength}`;
        });
        commentWrap.appendChild(cTitle);
        commentWrap.appendChild(textarea);
        commentWrap.appendChild(counter);
        fs.appendChild(commentWrap);

        body.appendChild(fs);
        card.appendChild(head);
        card.appendChild(body);
        form.appendChild(card);
      });
    }

    // ----- Progress tracking -----
    function updateProgress(){
      const total = sections.reduce((acc, s) => acc + s.questions.length, 0);
      const answered = form.querySelectorAll('input[type="radio"]:checked').length;
      const pct = Math.round((answered / total) * 100);
      progressBar.style.width = pct + '%';
      progressText.textContent = `Answered ${answered} of ${total}`;
      a11yStatus.textContent = `Progress: ${answered} of ${total} answered`;
    }

    // ----- Validation -----
    function validateAll(){
      let firstInvalid = null;
      // clear previous markers
      form.querySelectorAll('.question').forEach(q => {
        q.classList.remove('invalid');
        q.classList.remove('error');
      });

      // walk radio groups
      const groups = new Set();
      form.querySelectorAll('input[type="radio"]').forEach(r => groups.add(r.name));

      let invalidCount = 0;
      groups.forEach(name => {
        const group = Array.from(form.querySelectorAll(`input[name="${CSS.escape(name)}"]`));
        const checked = group.some(r => r.checked);
        if (!checked){
          invalidCount++;
          const wrap = group[0].closest('.question');
          if (wrap){
            wrap.classList.add('invalid', 'error');
            if (!firstInvalid) firstInvalid = wrap;
          }
        }
      });

      if (firstInvalid){
        firstInvalid.scrollIntoView({behavior: 'smooth', block: 'center'});
        const r = firstInvalid.querySelector('input[type="radio"]');
        if (r) r.focus({preventScroll:true});
      }
      return invalidCount === 0;
    }

    // ----- Toast -----
    function showToast(msg, ms=2200){
      toast.textContent = msg;
      toast.classList.add('show');
      window.setTimeout(() => toast.classList.remove('show'), ms);
    }

    // ----- Event wiring -----
    function wire(){
      // update progress on change
      form.addEventListener('change', (e) => {
        if (e.target && e.target.matches('input[type="radio"]')){
          const wrap = e.target.closest('.question');
          if (wrap){
            wrap.classList.remove('invalid', 'error');
          }
          updateProgress();
        }
      });

      // handle submit
      form.addEventListener('submit', (e) => {
        e.preventDefault();

        if (!validateAll()){
          showToast('Please answer all questions.');
          return;
        }

        // Collect answers safely
        const data = {};
        const checked = form.querySelectorAll('input[type="radio"]:checked');
        checked.forEach(r => { data[r.name] = r.value; });

        // include non-empty comments
        form.querySelectorAll('textarea[name$="-comment"]').forEach(t => {
          const v = t.value.trim();
          if (v) data[t.name] = v;
        });

        // Example: send to server (placeholder)
        // fetch('/submit', { method:'POST', headers:{'Content-Type':'application/json','X-CSRF-Token': token }, body: JSON.stringify(data) })
        //   .then(...)
        showToast('All good! Answers captured locally (demo).');
        console.log('Collected answers (demo):', data);
      });

      // reset button
      btnReset.addEventListener('click', () => {
        form.reset();
        updateProgress();
        form.querySelectorAll('.question').forEach(q => q.classList.remove('invalid','error'));
        showToast('Form reset.');
      });

      // Warn on unload if partially filled
      window.addEventListener('beforeunload', (e) => {
        const answered = form.querySelectorAll('input[type="radio"]:checked').length;
        if (answered > 0){
          e.preventDefault();
          e.returnValue = '';
        }
      });
    }

    // ----- Init -----
    buildSurvey();
    wire();
    updateProgress();

    // ---------------- Security notes (client-side) ----------------
    // - No untrusted HTML injection; all dynamic text uses textContent.
    // - Radio names are fixed and derived from indices; IDs are not user-controlled.
    // - For deployment, set strong HTTP headers (CSP, HSTS, X-Content-Type-Options, etc.).
    // - Server must re-validate all inputs and use anti-CSRF tokens for POST.
  })();
  </script>
</body>
</html>
